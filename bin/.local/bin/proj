#!/usr/bin/env bash

# proj ncko/what # ~/projects/ncko/what
# proj deck/what # ~/deck/what

in_tmux_session=$TMUX
tmux_running=$(pgrep tmux)

if [ $# -eq 0 ]; then
    echo "No arguments supplied"
    exit 1
fi


prefix=`echo $1 | cut -d / -f 1`
project_name=`echo $1 | cut -d / -f 2`

if [ $prefix == "deck" ]; then
  location="/Users/ncko/$1"
else
  location="/Users/ncko/projects/$1"
fi

mkdir -p $location

# if not in tmux session and tmux is not running
if [[ -z $in_tmux_session ]] && [[ -z $tmux_running ]]; then
    tmux new-session -s $project_name -c $location
    exit 0
fi

# if tmux does not have a session with the name $project_name
if ! tmux has-session -t "$project_name" 2> /dev/null; then
    tmux new-session -s "$project_name" -c "$location" -d
fi

# if not in tmux session and tmux is running
if [[ -z $in_tmux_session ]]; then
    tmux attach-session -t $project_name
else
    tmux switch-client -t $project_name
fi
